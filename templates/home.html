{% extends "base.html" %}

{% block title %}YouTube MP3 & MP4 Downloader – Fast, simple converter{% endblock %}

{% block content %}
  <section class="mb-3">
    <div class="label-pill">
      <span class="badge-dot"></span>
      {{ t('hero_badge') }}
    </div>
    <h1 class="hero-title">{{ t('hero_title') }}</h1>
    <p class="hero-subtitle">
      {{ t('hero_subtitle') }}
    </p>
  </section>

  <section class="card-elevated">
    {% for category, message in get_flashed_messages(with_categories=True) %}
      <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
    {% endfor %}

    <form action="/details" method="POST" id="downloadForm" onsubmit="return showOverlay()">
      <div class="form-group mb-3">
        <div class="input-label">{{ t('url_label') }}</div>
        <input
          type="url"
          class="form-control form-control-url"
          id="youtube_url"
          name="youtube_url"
          placeholder="{{ t('url_placeholder') }}"
          required
          aria-label="Video URL (YouTube / X / Vimeo)"
        />
      </div>

      <div class="d-flex flex-column flex-md-row align-items-stretch align-items-md-center justify-content-between">
        <button type="submit" class="btn btn-primary-main mb-2 mb-md-0">
          {{ t('home_primary_cta') }}
        </button>
        <button
          type="button"
          class="btn btn-secondary-ghost"
          onclick="document.getElementById('youtube_url').value=''; document.getElementById('youtube_url').focus();">
          {{ t('home_clear') }}
        </button>
      </div>

      <div class="feature-list">
        <div class="feature-item">
          <span class="feature-dot"></span>
          {{ t('feature_mp3') }}
        </div>
        <div class="feature-item">
          <span class="feature-dot"></span>
          {{ t('feature_mp4') }}
        </div>
        <div class="feature-item">
          <span class="feature-dot"></span>
          {{ t('feature_background') }}
        </div>
        <div class="feature-item">
          <span class="feature-dot"></span>
          {{ t('feature_cookie') }}
        </div>
      </div>
    </form>

    <p class="legal-disclaimer">
      {{ t('legal_home') }}
    </p>
  </section>
{% endblock %}

{% block scripts %}
<script>
  function validateSupportedUrl() {
    var url = document.getElementById('youtube_url').value;
    // 서버에서 최종 검증을 다시 수행하지만,
    // 클라이언트에서는 대략적인 도메인만 확인해 사용성을 높인다.
    var youtube = /^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\//;
    var twitter = /^(https?:\/\/)?(www\.)?(x\.com|twitter\.com)\//;
    var vimeo   = /^(https?:\/\/)?(www\.)?vimeo\.com\//;
    return youtube.test(url) || twitter.test(url) || vimeo.test(url);
  }

  function showOverlay() {
    if (!validateSupportedUrl()) {
      alert('지원하지 않는 URL 형식입니다.\nYouTube / X(Twitter) / Vimeo 링크만 입력해 주세요.');
      return false;
    }
    const overlay = document.getElementById('overlay');
    const progressBar = document.getElementById('progressBar');
    overlay.style.display = 'flex';

    let width = 0;
    const interval = setInterval(() => {
      if (width >= 96) {
        clearInterval(interval);
        return;
      }
      if (width < 40) width += 7;
      else if (width < 80) width += 4;
      else width += 1;
      progressBar.style.width = width + '%';
    }, 220);

    setTimeout(() => {
      clearInterval(interval);
      overlay.style.display = 'none';
      progressBar.style.width = '0%';
    }, 20000);

    return true;
  }
</script>
{% endblock %}
